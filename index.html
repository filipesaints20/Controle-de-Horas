<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard de Horas</title>
</head>
<body>

<h1 id="nome"></h1>
<h2>Saldo atual: <span id="saldo"></span> horas</h2>

<hr>

<h3>Lançar horas</h3>
<input id="mais" type="number" placeholder="Horas a mais">
<input id="menos" type="number" placeholder="Horas a menos">
<button onclick="enviar()">Enviar</button>

<hr>

<h3>Histórico</h3>
<ul id="hist"></ul>

<script>
const API = "https://script.google.com/macros/s/AKfycbwgRacSB3NbqBdbJ7SHbefmZyIAtZ7KDoBeJxi5KdVsCtGwBUq9GQYqiDuC5I4NVLc3/exec";
const token = new URLSearchParams(window.location.search).get("token");

function carregar() {
  fetch(`${API}?token=${token}`)
    .then(r => r.json())
    .then(d => {
      if (d.erro) {
        alert("Acesso negado");
        return;
      }

      document.getElementById("nome").innerText = d.nome;
      document.getElementById("saldo").innerText = d.saldo;

      const hist = document.getElementById("hist");
      hist.innerHTML = "";

      d.historico.forEach(l => {
        hist.innerHTML += `<li>${l[0]} | +${l[2]} -${l[3]} | saldo ${l[4]}</li>`;
      });
    });
}

function enviar() {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      token,
      mais: document.getElementById("mais").value,
      menos: document.getElementById("menos").value
    })
  }).then(() => carregar());
}

carregar();
</script>

</body>
</html>
